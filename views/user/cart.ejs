<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Eshope</title>
  <meta name="keywords" content="HTML5 Template">
  <meta name="description" content="Eshope">
  <meta name="author" content="p-themes">
  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="../../assets/images/icons/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../assets/images/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../assets/images/icons/favicon-16x16.png">
  <link rel="manifest" href="../../assets/images/icons/site.html">
  <link rel="mask-icon" href="../../assets/images/icons/safari-pinned-tab.svg" color="#666666">
  <link rel="shortcut icon" href="../../assets/images/icons/favicon.ico">
  <meta name="apple-mobile-web-app-title" content="Molla">
  <meta name="application-name" content="Molla">
  <meta name="msapplication-TileColor" content="#cc9966">
  <meta name="msapplication-config" content="../../assets/images/icons/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
  <!-- Plugins CSS File -->
  <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../assets/css/plugins/owl-carousel/owl.carousel.css">
  <link rel="stylesheet" href="../../assets/css/plugins/magnific-popup/magnific-popup.css">
  <!-- Main CSS File -->
  <link rel="stylesheet" href="../../assets/css/style.css">
  <link rel="stylesheet" href="../../assets/css/plugins/nouislider/nouislider.css">
</head>




<%-include('../partials/userheader')-%>


<main class="main">
  <div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
    <div class="container">
      <h1 class="page-title">Cart Items</h1>
    </div><!-- End .container -->
  </div><!-- End .page-header -->
    

    <div class="page-content">
      <div class="cart">
          <div class="container">
            <div class="row">
              <div class="col-lg-9">

        <% if (product.length > 0) { %>
                <table class="table table-cart table-mobile">
          <thead>
            <tr>
              <th>Product</th>
              <th>Price</th>
              <th>Quantity</th>
              <th>Total</th>
              <th></th>
            </tr>
          </thead>

          <tbody>
            
            <% product.forEach(function(product,index) { %>
            <tr>
              <td class="product-col">
                <div class="product">
                  <figure class="product-media">
                    <a href="#">
                      <img src="<%=product.image[0]%>" alt="Product image">
                    </a>
                  </figure>

                  <h3 class="product-title">
                    <a href="#"><%=product.name%></a>
                  </h3><!-- End .product-title -->
                </div><!-- End .product -->
              </td>
              <td class="price-col"><%=product.price%></td>
              <td>
                <button class="cart-item-count mr-3" onclick="changeQuantity('<%=product._id%>','<%=cartId%>',-1)">-</button>
                <span id="<%=product._id%>"><%=product.quantity%></span>
                <button class="cart-item-count ml-3" onclick="changeQuantity('<%=product._id%>','<%=cartId%>',1)">+</button>                     
              </td>
              <td class="total-col"><%=product.total%></td>
              <td><button type="button" class="btn btn-danger" style="width: 40px;"  onclick="confirmremoveItem('<%=product._id%>')">remove</button></td>
              
            </tr>
            <% })%>
            
          </tbody>
        </table><!-- End .table table-wishlist -->
        <% } else { %>
     <h2 style="color: chocolate;" > Sorry Your Cart Is Empty</h4>
          <% } %>
               <div><% if (unavailable) { %>
                <p style="display: inline;">Only</p>
                <% unavailable.forEach(function(unavailable,index) { %>
                  <p style="display: inline;"><%=unavailable.quantity%> Pieces of <%=unavailable.productName%></p>
                <% })%>
                <p style="display: inline;">is available</p>  
                <% } %>
               </div>
                <div class="cart-bottom"> 
                <div class="cart-discount">
                  <form action="/check-out">
                    <div class="input-group">
                    <input type="text" class="form-control" required placeholder="coupon code">
                    <div class="input-group-append">
                  <button class="btn btn-outline-primary-2" type="submit"><i class="icon-long-arrow-right"></i></button>
                </div><!-- .End .input-group-append -->
                  </div><!-- End .input-group -->
                  </form>
                </div><!-- End .cart-discount -->

                
              </div><!-- End .cart-bottom -->
              </div><!-- End .col-lg-9 -->
              <aside class="col-lg-3">
                <div class="summary summary-cart">
                  <h3 class="summary-title">Cart Total</h3><!-- End .summary-title -->

                  <table class="table table-summary">
                    <tbody>
                     

                      <!-- End .summary-shipping-row -->

                      <!-- End .summary-shipping-row -->

                      <!-- End .summary-shipping-row -->

                      <!-- End .summary-shipping-estimate -->

                      <tr class="summary-total">
                        <td>Total:</td>
                        <td><%=subtotal%></td>
                      </tr><!-- End .summary-total -->
                    </tbody>
                  </table><!-- End .table table-summary -->

                  <a href="/check-Out" class="btn btn-outline-primary-2 btn-order btn-block">PROCEED TO CHECKOUT</a>
                </div><!-- End .summary -->

              
              </aside><!-- End .col-lg-3 -->
            </div><!-- End .row -->
          </div><!-- End .container -->
        </div><!-- End .cart -->
    </div><!-- End .page-content -->
</main><!-- End .main -->


<%-include('../partials/userfooter')-%>



<script src="../../assets/js/jquery.min.js"></script>
    <script src="../../assets/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/jquery.hoverIntent.min.js"></script>
    <script src="../../assets/js/jquery.waypoints.min.js"></script>
    <script src="../../assets/js/superfish.min.js"></script>
    <script src="../../assets/js/owl.carousel.min.js"></script>
    <script src="../../assets/js/bootstrap-input-spinner.js"></script>
    <script src="../../assets/js/jquery.elevateZoom.min.js"></script>
    <script src="../../assets/js/bootstrap-input-spinner.js"></script>
    <script src="../../assets/js/jquery.magnific-popup.min.js"></script>
    <!-- Main JS File -->

    <script src="../../assets/main.js"></script>
    <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>


<script>
  function changeQuantity( proid,cartid,count) {
    let quantity=parseInt(document.getElementById(proid).innerHTML)
    count=parseInt(count)
    $.ajax({
      url: '/change-product-quantity',
      data: {
        product: proid,
        cart: cartid,
        count: count,
        quantity:quantity
      },
      method: 'post',
      success: (response) => {
        if(response.removeProduct){
          new swal("Item removed", "", "warning");
          location.reload()
        }else if(response.limitreached){
          new swal("Out of stock", "", "warning");
        }else{
          document.getElementById(proid).innerHTML=quantity+count
          location.reload()
        }
      }
    });
  }

  function confirmremoveItem(proId) {
  new swal({
    title: 'Do you want to proceed?',
    icon: 'warning',
    showCancelButton: true,
    showConfirmButton: true,
    confirmButtonText: 'Yes'
  }).then((result) => {
    if (result.isConfirmed) {
      removeItem(proId);
      new swal("Item Removed Successfully", "", "success");
    } else if (result.dismiss === swal.DismissReason.cancel) {
      new swal("Item not Removed", "", "info");
    }
  });
}



  function removeItem( proid) {
    $.ajax({
      url: '/remove-item',
      data: {
        proid: proid,
      },
      method: 'post',
      success: (response) => {
          location.reload()
      }
    });
  }
</script>
